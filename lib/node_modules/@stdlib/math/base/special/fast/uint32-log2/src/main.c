/**
* @license Apache-2.0
*
* Copyright (c) 2024 The Stdlib Authors.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*    http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

#include "stdlib/math/base/special/fast/uint32_log2.h"
#include <stdint.h>

static const uint32_t B4 = 0xFFFF0000u;
static const uint32_t B3 = 0xFF00u;
static const uint32_t B2 = 0xF0u;
static const uint32_t B1 = 0xCu;
static const uint32_t B0 = 0x2u;
static const uint32_t S4 = 16u;
static const uint32_t S3 = 8u;
static const uint32_t S2 = 4u;
static const uint32_t S1 = 2u;
static const uint32_t S0 = 1u;

/**
* Computes an integer binary logarithm (base two).
*
* @param x    number
* @returns    integer binary logarithm
*
* @example
* uint32_t out = stdlib_base_fast_uint32_log2( 8 );
* // returns 3
*/
uint32_t stdlib_base_fast_uint32_log2( uint32_t x ) {
    uint32_t out = 0u;
    uint32_t y = x;

    // `x >= 65536`:
    if ( y & B4 ) {
        y >>= S4;
        out |= S4;
    }
    // `x >= 256`:
    if ( y & B3 ) {
        y >>= S3;
        out |= S3;
    }
    // `x >= 16`:
    if ( y & B2 ) {
        y >>= S2;
        out |= S2;
    }
    // `x >= 4`:
    if ( y & B1 ) {
        y >>= S1;
        out |= S1;
    }
    // `x >= 2`:
    if ( y & B0 ) {
        y >>= S0;
        out |= S0;
    }
    return out;
}
